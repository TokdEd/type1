<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>äººæ½®é›·é”ç®¡ç†å¾Œå° | Admin Panel</title>
  <meta name="viewport" initial-scale=1.0, width=device-width" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      padding: 40px;
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 2.5em;
      font-weight: 300;
    }
    
    .admin-section {
      background: rgba(255,255,255,0.8);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.3);
    }
    
    .section-title {
      font-size: 1.5em;
      color: #444;
      margin-bottom: 20px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
      font-size: 1.1em;
    }
    
    input[type="number"], input[type="text"] {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e8ed;
      border-radius: 10px;
      font-size: 1em;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.9);
    }
    
    input[type="number"]:focus, input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }
    
    .coordinate-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 10px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102,126,234,0.3);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .current-status {
      background: rgba(102,126,234,0.1);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(102,126,234,0.2);
    }
    
    .status-item:last-child {
      border-bottom: none;
    }
    
    .status-label {
      font-weight: 600;
      color: #667eea;
    }
    
    .status-value {
      font-family: 'Courier New', monospace;
      color: #333;
      background: rgba(255,255,255,0.8);
      padding: 5px 10px;
      border-radius: 5px;
    }
    
    .preset-locations {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .preset-btn {
      background: rgba(102,126,234,0.1);
      border: 2px solid #667eea;
      color: #667eea;
      padding: 15px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .preset-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }
    
    .message {
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      font-weight: 600;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .message.success {
      background: rgba(46,204,113,0.1);
      color: #27ae60;
      border: 2px solid #2ecc71;
    }
    
    .message.error {
      background: rgba(231,76,60,0.1);
      color: #c0392b;
      border: 2px solid #e74c3c;
    }
    
    .message.show {
      opacity: 1;
    }
    
    .back-link {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      color: #667eea;
      text-decoration: none;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .back-link:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <a href="/" class="back-link">â† è¿”å›ä¸»é </a>
  
  <div class="container">
    <h1>ğŸ›ï¸ äººæ½®é›·é”ç®¡ç†å¾Œå°</h1>
    
    <!-- ç•¶å‰ç‹€æ…‹é¡¯ç¤º -->
    <div class="admin-section">
      <div class="section-title">ğŸ“ ç•¶å‰ä½ç½®ç‹€æ…‹</div>
      <div class="current-status">
        <div class="status-item">
          <span class="status-label">ç·¯åº¦ (Latitude)</span>
          <span class="status-value" id="current-lat">è¼‰å…¥ä¸­...</span>
        </div>
        <div class="status-item">
          <span class="status-label">ç¶“åº¦ (Longitude)</span>
          <span class="status-value" id="current-lon">è¼‰å…¥ä¸­...</span>
        </div>
        <div class="status-item">
          <span class="status-label">æœ€å¾Œæ›´æ–°æ™‚é–“</span>
          <span class="status-value" id="last-update">--</span>
        </div>
      </div>
      <button class="btn btn-secondary" onclick="getCurrentLocation()">ğŸ”„ åˆ·æ–°ç•¶å‰ä½ç½®</button>
    </div>
    
    <!-- æ‰‹å‹•è¨­å®šåº§æ¨™ -->
    <div class="admin-section">
      <div class="section-title">ğŸ¯ æ‰‹å‹•è¨­å®šåº§æ¨™</div>
      <form id="coordinate-form">
        <div class="coordinate-row">
          <div class="form-group">
            <label for="latitude">ç·¯åº¦ (Latitude)</label>
            <input type="number" id="latitude" step="any" placeholder="ä¾‹å¦‚ï¼š25.0330" required>
            <small style="color:#666;">ç¯„åœï¼š-90 åˆ° 90</small>
          </div>
          <div class="form-group">
            <label for="longitude">ç¶“åº¦ (Longitude)</label>
            <input type="number" id="longitude" step="any" placeholder="ä¾‹å¦‚ï¼š121.5654" required>
            <small style="color:#666;">ç¯„åœï¼š-180 åˆ° 180</small>
          </div>
        </div>
        <button type="submit" class="btn">âœ… æ›´æ–°ä½ç½®</button>
      </form>
    </div>
    
    <!-- é è¨­ä½ç½® -->
    <div class="admin-section">
      <div class="section-title">ğŸ—ºï¸ é è¨­ä½ç½®å¿«é€Ÿé¸æ“‡</div>
      <div class="preset-locations">
        <button class="preset-btn" onclick="setPresetLocation(25.0330, 121.5654, 'å°åŒ—101')">
          ğŸ¢ å°åŒ—101
        </button>
        <button class="preset-btn" onclick="setPresetLocation(25.0478, 121.5170, 'å°åŒ—è»Šç«™')">
          ğŸš‰ å°åŒ—è»Šç«™
        </button>
        <button class="preset-btn" onclick="setPresetLocation(25.0408, 121.5440, 'è±¡å±±')">
          ğŸ”ï¸ è±¡å±±
        </button>
        <button class="preset-btn" onclick="setPresetLocation(25.0375, 121.5645, 'ä¿¡ç¾©å€')">
          ğŸ›ï¸ ä¿¡ç¾©å€
        </button>
        <button class="preset-btn" onclick="setPresetLocation(25.0419, 121.5103, 'è¥¿é–€ç”º')">
          ğŸ­ è¥¿é–€ç”º
        </button>
        <button class="preset-btn" onclick="setPresetLocation( 22.987700,120.218900, 'é•·æ¦®è·¯')">
          ğŸœ é•·æ¦®è·¯
        </button>
        <button class="preset-btn" onclick="setPresetLocation(35.63278, 139.88056, 'æ±äº¬')">
          ğŸ—¾ æ±äº¬ (æ¸¬è©¦ç”¨)
        </button>
        <button class="preset-btn" onclick="setPresetLocation(40.7128, -74.0060, 'ç´ç´„')">
          ğŸ—½ ç´ç´„ (æ¸¬è©¦ç”¨)
        </button>
      </div>
    </div>
    
    <div id="message" class="message"></div>
  </div>

  <script>
    // å…¨å±€è®Šæ•¸
    let currentLat = null;
    let currentLon = null;
    
    // é é¢è¼‰å…¥æ™‚ç²å–ç•¶å‰ä½ç½®
    document.addEventListener('DOMContentLoaded', function() {
      getCurrentLocation();
    });
    
    // ç²å–ç•¶å‰ä½ç½®
    function getCurrentLocation() {
      // é€™è£¡æˆ‘å€‘éœ€è¦å¾ä¸»é é¢ç²å–ç•¶å‰ä½ç½®
      // ç”±æ–¼æ˜¯åœ¨ä¸åŒé é¢ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨localStorageæˆ–è€…API
      
      // å˜—è©¦å¾localStorageç²å–
      const savedLat = localStorage.getItem('currentLat');
      const savedLon = localStorage.getItem('currentLon');
      
      if (savedLat && savedLon) {
        currentLat = parseFloat(savedLat);
        currentLon = parseFloat(savedLon);
        updateCurrentStatus();
      } else {
        // ä½¿ç”¨ç€è¦½å™¨åœ°ç†ä½ç½®API
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function(position) {
              currentLat = position.coords.latitude;
              currentLon = position.coords.longitude;
              updateCurrentStatus();
              saveToLocalStorage();
            },
            function(error) {
              console.warn('ç„¡æ³•ç²å–ä½ç½®:', error);
              // ä½¿ç”¨é è¨­å°åŒ—ä½ç½®
              currentLat = 25.0330;
              currentLon = 121.5654;
              updateCurrentStatus();
              saveToLocalStorage();
            }
          );
        } else {
          // ä½¿ç”¨é è¨­å°åŒ—ä½ç½®
          currentLat = 25.0330;
          currentLon = 121.5654;
          updateCurrentStatus();
          saveToLocalStorage();
        }
      }
    }
    
    // æ›´æ–°ç•¶å‰ç‹€æ…‹é¡¯ç¤º
    function updateCurrentStatus() {
      document.getElementById('current-lat').textContent = currentLat ? currentLat.toFixed(6) : 'æœªè¨­å®š';
      document.getElementById('current-lon').textContent = currentLon ? currentLon.toFixed(6) : 'æœªè¨­å®š';
      document.getElementById('last-update').textContent = new Date().toLocaleString('zh-TW');
    }
    
    // ä¿å­˜åˆ°localStorage
    function saveToLocalStorage() {
      if (currentLat !== null && currentLon !== null) {
        localStorage.setItem('currentLat', currentLat.toString());
        localStorage.setItem('currentLon', currentLon.toString());
        
        // ç™¼é€æ¶ˆæ¯çµ¦ä¸»é é¢ï¼ˆå¦‚æœåœ¨åŒä¸€ç€è¦½å™¨æ¨™ç±¤ä¸­ï¼‰
        try {
          window.postMessage({
            type: 'LOCATION_UPDATE',
            lat: currentLat,
            lon: currentLon
          }, '*');
        } catch (e) {
          console.log('ç„¡æ³•ç™¼é€æ¶ˆæ¯çµ¦ä¸»é é¢');
        }
      }
    }
    
    // è¡¨å–®æäº¤è™•ç†
    document.getElementById('coordinate-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const lat = parseFloat(document.getElementById('latitude').value);
      const lon = parseFloat(document.getElementById('longitude').value);
      
      if (isNaN(lat) || isNaN(lon)) {
        showMessage('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—', 'error');
        return;
      }
      
      if (lat < -90 || lat > 90) {
        showMessage('ç·¯åº¦å¿…é ˆåœ¨ -90 åˆ° 90 ä¹‹é–“', 'error');
        return;
      }
      
      if (lon < -180 || lon > 180) {
        showMessage('ç¶“åº¦å¿…é ˆåœ¨ -180 åˆ° 180 ä¹‹é–“', 'error');
        return;
      }
      
      updateLocation(lat, lon, 'æ‰‹å‹•è¨­å®š');
    });
    
    // é è¨­ä½ç½®è¨­å®š
    function setPresetLocation(lat, lon, name) {
      document.getElementById('latitude').value = lat;
      document.getElementById('longitude').value = lon;
      updateLocation(lat, lon, name);
    }
    
    // æ›´æ–°ä½ç½®
    function updateLocation(lat, lon, source) {
      currentLat = lat;
      currentLon = lon;
      
      updateCurrentStatus();
      saveToLocalStorage();
      
      showMessage(`âœ… ä½ç½®å·²æ›´æ–°ç‚º ${source}ï¼š(${lat.toFixed(6)}, ${lon.toFixed(6)})`, 'success');
      
      // æ¸…ç©ºè¡¨å–®
      setTimeout(() => {
        document.getElementById('latitude').value = '';
        document.getElementById('longitude').value = '';
      }, 2000);
    }
    
    // é¡¯ç¤ºè¨Šæ¯
    function showMessage(text, type) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = text;
      messageEl.className = `message ${type} show`;
      
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 3000);
    }
    
    // ç›£è½ä¾†è‡ªä¸»é é¢çš„æ¶ˆæ¯
    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'LOCATION_REQUEST') {
        // ä¸»é é¢è«‹æ±‚ç•¶å‰ä½ç½®
        window.postMessage({
          type: 'LOCATION_RESPONSE',
          lat: currentLat,
          lon: currentLon
        }, '*');
      }
    });
  </script>
</body>
</html> 